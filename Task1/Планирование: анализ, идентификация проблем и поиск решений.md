# Планирование: анализ, идентификация проблем и поиск решений

## Существующие и потенциальные проблемные места

На основе обращений от пользователей и операторов системы MES можно выявить следующие проблемы:

### 1. Потерянные заказы

Клиенты компании обращаются спустя долгое время после отправки запроса, что приводит к недовольству, потере прибыли и крупных заказов.
Вероятно в системе происходят ошибки, приводящие к несогласованному состоянию.
Для локализации проблемы требуется внедрение мониторинга ошибок и трассировки запросов

### 2. Долгий просчет стоимости изделия от MES

Унаследованная проблема проявляется с самого начала работы с софтом MES.
Увеличение числа запросов на обработку только усугубило проблему.
Софт MES хоть и принадлежит компании, но был унаследован, и у команды недостаточно экспертизы для оптимизации сложных алгоритмов просчета стоимости

### 3. Долгое время ожидания загрузки страницы заказов

Операторы системы вынуждены долго ждать загрузки страницы.
Вероятно есть неоптимальный запрос в БД, который стал проявляться после увеличения нагрузки.
Команда совершала безуспешные попытки оптимизации запросов, основанные на ошибочных предположениях.
Для локализации проблемы требуется внедрение мониторинга медленных запросов в БД и внедрение распределенной трассировки
Проблема может усугубиться при дальнейшем увеличении числа заказов в системе.

### 4. Высокий показатель Time To Market

Процесс заказа достаточно сложный и приводит к увеличению цикла тестирования и разработки при обнаружении ошибок.
Кроме того есть дисбаланс в команде - один QA-инженер на 5 разработчиков
Вероятно сказывается усложнение системы и накопление техдолга после внедрения API для B2C-клиентов.
Проблема может усугубиться в дальнейшем после разработки новых бизнес-фич


## Инициативы, которые необходимы для устранения нежелательных ситуаций

### 1. Расширение логирования

Для решения острой проблемы с потерянными заказами требуется выявить наиболее важные места в бизнес-процессе на основе этапов заказа и добавить логирование в код.

- Логи уровня Error и Warning при любых исключениях и таймаутах.
- Логи уровня Info при любой смене этапа заказа, включая всю необходимую информацию о заказе

Также настроить алертинг при превышении допустимого порога ошибок

Решение позволит оперативно обнаруживать и исправлять проблемы системы.

В качестве инструментов использовать стек ELK как наиболее популярный и имеющий множество библиотек

### 2. Внедрение мониторинга

Внедрение сбора технических и бизнес-метрик о работе сервиса.

Технический мониторинг внедряется достаточно быстро и позволит выявить наиболее нагруженные сервисы и масштабировать их при необходимости.
Сервисы компании расположены в облачной инфраструктуре и позволят масштабировать систему как горизонтально, так и вертикально.

Также настроить алертинг при превышении порога ошибок 5xx и 4xx

Решение позволит быстро реагировать на увеличение нагрузки и избежать отказов системы.

Инструменты - Prometheus и Grafana

### 3. Внедрение трассировки запросов

Внедрить трассировку. Так как сервисов у компании несколько, то требуется распределенное решение.
При решении обязательно учесть асинхронное взаимодействие через брокер сообщений - добавить trace_id в сообщения от продюсера.
Кроме того рекомендую добавить trace_id в логи для поиска связанных логов

Решение позволит выявлять и отслеживать наиболее проблемные места с точки зрения производительности.

Это особенно важно для унаследованного проекта, так как позволит понять в каком именно участке кода происходят задержки при обработке 3D-модели

Инструменты - OpenTelemetry и Jaeger

### 4. Найм второго QA-инженера

Инженер по ручному тестированию проявляет интерес к автоматизации, но из-за большой нагрузки не может уделить больше времени автоматизации.
Стратегическим решением может стать найм второго QA-инженера. Что также позволит снизить BUS-factor и риски, что будет некому выполнять контроль качества.

### 5. Внедрение автоматизированного тестирования

Отсутствие автоматизации проявляется в задержках в релизах и потенциально может привести к убыткам в компании.
Для решения можно внедрить автоматизированное тестирование со сквозными и интеграционными тестами, проверяющими основной функционал сервиса - отправку, обработку и выполнение заказов

Автоматизированные тесты можно запускать во время каждого деплоя в тестовую среду, что позволит отловить проблему на раннем этапе.

### 6. Анализ логов, метрик, трейсов

Теперь, когда будет наглядное представление системы и ее состояние, можно принять решения и создать задачи для дальнейшей оптимизации процессов


## Видение целевой архитектуры через полгода

Сервис имеет мониторинг и расширенное логирование.
Мониторинг позволил выявить нагруженные сервисы и они были масштабированы.
Число отказов снизилось и компания перестала терять клиентов.
Нанят второй QA-инженер и начата разработка автотестов.

3 действия, которые необходимы в первую очередь
- Расширение логирования
- Мониторинг сервисов
- Найм QA-инженера в штат
