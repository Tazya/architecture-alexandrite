# Архитектурное решение по логированию

## Мотивация
Логирование - наиболее важная часть наблюдаемости системы с точки зрения ошибок и бизнес-логики
С помощью логов можно изучать и понимать причины проблем, подробно отслеживать ход заказов и узнать какие ошибки происходили при выполнении того или иного запроса.
Логи позволят узнать о проблеме еще до обращения клиентов. Это особенно важно, учитывая, что часть пользователей может игнорировать проблему и уйти из продукта не оставив обратной связи.

### Технические и бизнес-метрики, на которые может повлиять внедрение логирования

- Количество потерянных заказов
- Number of HTTP 500
- Количество успешно выполненных заказов

Считаю, что логирование требует внедрения во всех системах до трейсинга.

## Предлагаемое решение

Техническое решение для облака - ELK, как наиболее популярный стек с развитым поиском.

### Шаги решения:

- Настроить стек ELK
- Настроить Logstash на прослушивание STDOUT проектов и запись логов в кибану
- Настроить права доступа на просмотр логов в кибане
- Каждый сервис настроить на запись логов уровня INFO, WARNING, ERROR в stdout

Впоследствии также внедрить логирование Frontend-сервисов с помощью Sentry для отслеживания клиентских ошибок

### Работа с чувствительными данными

**Со стороны сервисов:**

Определить поля и значения, которые могут быть чувствительны, например пароли, api-ключи. На стороне сервисов настроить клиент записи логов на скрытие значений перед отправкой в STDOUT

**Со стороны Kibana:**
Настроить права доступа. К логам должны иметь доступ разработчики, тимлид, специалисты поддержки и DevOps инженер.
Доступ по сети настроить аналогично трейсингу - только из внутренней сети или VPN.

Хранить логи не менее 2х месяцев в связи с длительным жизненным циклом заказа, далее удалять.
Создать отдельные индексы на каждый день.
Размер для хранения на данном этапе определить сложно, он должен поддерживать хранение не менее миллиона документов за два месяца для возможности записи всех шагов всех заказов.

## Мероприятия для превращения системы сбора логов в систему анализа логов

Алертинг необходим, можно настроить отправку ботом в мессенджер и на почту.
Алерты отправлять на ошибки при смене статуса заказов а так же при превышении квоты на логи, так можно отследить отказ системы или DDoS-атаку



